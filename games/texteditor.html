<!DOCTYPE html>
<html lang="en">

<head>
  <title>Text Editor</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="icon" href="../icon.png">
  <link rel="stylesheet" href="../styles.css">
  <link rel="stylesheet" href="texteditor/text-edit.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="texteditor/jscolor.js"></script>
  <script src="texteditor/FileSaver.js"></script>

</head>
<body>

<div class="container">
<div id="editor">
    <h1 id="title">Page Title</h1>
    <p id="body">Page content</p>
</div>
</div>





<div class = "container" id = "footer">

<div class = "row" id = "file-input"> 
<input type='file' name = 'file' class = 'inputfile' accept='text/plain' id='file' onchange='openFile(event)'>
</div>


<div class = "row" id = "background-colour"> 
<p>
Background colour: <input class="jscolor" value="ab2567" id = 'colorPicker' onchange="updateBackground(this.jscolor)"> 
Text colour: <input class="jscolor" value="ab2567" id = 'colorPicker' onchange="updateText(this.jscolor)"> 
</p>
</div>



<div class = "row"> 
<div class="btn-group" role="group">
  <button type="button" class="btn btn-secondary" id = "backgroundButton" onclick = "toggleColorControl()" >Change colours</button>
  <button type="button" class="btn btn-secondary" id = "saveButton" onclick = "download()">Save text</button>
  <button type="button" class="btn btn-secondary" id = "loadBurron"> <label for="file" >Load text</label></button>
</div>
</div>


</div>





<script type="text/javascript">

  var title = document.getElementById('title');
  var body = document.getElementById('body');
  var filePannel = document.getElementById('file-input');
  var backgroundPannel = document.getElementById("background-colour");
  var backgroundButton = document.getElementById('backgroundButton');
  var colorPicker = document.getElementById('colorPicker');

  backgroundPannel.style.display = 'none';


  title.contentEditable = 'true';
  body.contentEditable = 'true';
  //can also set = 'plaintext-only' to avoid pasting hack but no support for firefox

  getCookieColors();


  function toggleColorControl() { 
    if (backgroundPannel.style.display === 'none') {
        backgroundPannel.style.display = 'block';
    } 
    else {
        backgroundPannel.style.display = 'none';
    }
  }


  function updateBackground(jscolor) {
    document.body.style.backgroundColor = '#' + jscolor;
    console.log("Updating background");
    console.log("Cookie was: " +  document.cookie);
    setCookie('BackgroundColor', '#' + jscolor);
    console.log("Cookie is now: " + document.cookie);
  }


  function updateText(jscolor) {
    document.getElementById("editor").style.color = '#' + jscolor;
    console.log("Updating text");
    console.log("Cookie was: " +  document.cookie);
    setCookie('TextColor','#' + jscolor);
    console.log("Cookie is now: " + document.cookie);
  }

  function setCookie(cname, cvalue) {
    document.cookie = cname + "=" + cvalue + ";";
}

function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
        }
    }
    return "";
}



  function applyCookieBackgroundColor(){
    document.body.style.backgroundColor = getCookie('BackgroundColor');
  }

  function applyCookieTextColor(){
    document.getElementById("editor").style.color = getCookie('TextColor');
  }


  function download() {
    var header_text = document.getElementById('title').innerText;
    var body_text = document.getElementById('body').innerText;
    var text = header_text + '\n\n' + body_text;
    var filename = "my_text";
    var blob = new Blob([text], {type: "text/plain;charset=utf-8"});
    saveAs(blob, filename+".txt");
  }

  function openFile(event) {

        var input = event.target;
        var reader = new FileReader();

        reader.onload = function(){
          var text = reader.result;
          var pivot = text.indexOf("\n\n");
 

          var header = text.substring(0,pivot);
          var body = text.substring(pivot+2);

          document.getElementById('title').innerText = header;
          document.getElementById('body').innerText = body;

        };

        reader.readAsText(input.files[0]);

  };

  function getCookieColors() {
    console.log("Page (re)loaded!")
    console.log("Cookie is " + document.cookie);
    console.log("Using colors stored in cookie");

    applyCookieBackgroundColor();
    applyCookieTextColor();
  }


  document.addEventListener("paste", function(e) {
    // cancel paste
    e.preventDefault();

    // get text representation of clipboard
    var text = e.clipboardData.getData("text/plain");

    // insert text manually
    document.execCommand("insertHTML", false, text);
  });


/**
  function setCookieBackground(color) {
    index = document.cookie.indexOf("Background color: ");
    if (index === -1) {
      console.log("Resetting cookie");
      document.cookie = "Text color: #ffffff, Background color: " + color;
      console.log("Reset cookie to: " + document.cookie);
    }
    else {
      document.cookie =  document.cookie.substring(0, index + "Background color: ".length) + color ;
    }
  }
  function setCookieTextColor(color) {
    index = document.cookie.indexOf("Text color: ");
    if (index === -1) {
      console.log("Resetting cookie");
      document.cookie = "Text color: " + color + ", Background color: #a5a5a5";
      console.log("Reset cookie to: " + document.cookie);
    }
    else {
      document.cookie =  document.cookie.substring(0, index + "Text color: ".length) + color + document.cookie.substring(index + "Text color: ".length + 7);
    }
  }
  

  function applyCookieBackgroundColor(){
    position = document.cookie.indexOf("Background color: ") + "Background color: ".length;
    backgroundC = document.cookie.substring(position);
    console.log("Got background as: " + backgroundC);
    document.body.style.backgroundColor = backgroundC;
  }

  function applyCookieTextColor(){
    position = document.cookie.indexOf("Text color: ") + "Text color: ".length;
    textC = document.cookie.substring(position, position+7);
    console.log(textC);
    console.log("Got text color as: " + textC);
    document.getElementById("editor").style.color = textC;
  }



  **/


</script>





</body>
</html>
